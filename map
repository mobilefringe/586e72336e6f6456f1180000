<script type="text/javascript" src="//mallmaverick.cdn.speedyrails.net/javascripts/mapsvg/jquery.js"></script>
<script type="text/javascript" src="//mallmaverick.cdn.speedyrails.net/javascripts/mapsvg/raphael.js"></script>
<script type="text/javascript" src="//mallmaverick.cdn.speedyrails.net/javascripts/mapsvg/jquery.mousewheel.js"></script>
<script type="text/javascript" src="//mallmaverick.cdn.speedyrails.net/system/site_images/photos/000/005/107/original/mallmaverick_svgmap.js?1412885524"></script>


<div id="desktopMap">
    <div class="" style="text-align:center;">
        <iframe src="https://mf-map.netlify.com/map?iframe=true&subdomain=londonderry&recenter=true" frameborder="0" width="100%" height="100%" id="iFrame1" sandbox="allow-top-navigation allow-scripts allow-same-origin"></iframe>
        <img id="IE_map" src="">
    </div>
</div>


<script>
    $(document).ready(function(e){
        init(e);
        function renderPageData(){
            console.log('IE ' + detectIE());
            if (detectIE()) {
                var svg_url = '//mallmaverickstaging.com'+ getPropertyDetails().svgmap_url;
                $('#iFrame1').remove();
                $("#IE_map").attr("src", svg_url)
            } else {
                $('#IE_map').remove();
            }
            
            show_content();
        }
        
        loadMallDataCached(renderPageData);
    });
    window.addEventListener('message', function(event) {
        // IMPORTANT: check the origin of the data! 
        if (event.origin.startsWith('https://mf-map.netlify.com')) { 
            // The data was sent from your site.
            // Data sent with postMessage is stored in event.data:
            if (event.data && event.data.selectedStore) {
                var store = event.data.selectedStore
                window.location.href= "/stores/"+store.slug
            }
            
            var query = window.location.search;
            var store_id = query.split('=')[1];
            var store_details = getStoreDetailsByID(store_id)
            if (event.origin.startsWith('https://mf-map.netlify.com') && event.data.event === "map-loaded") {
                if (event.data) {
                    var loading = event.data.loading;
                    if (!loading && store_details){
                        let frame = document.getElementById('iFrame1');
                        frame.contentWindow.postMessage({ event: "select-store", selectedStore: store_details }, '*');
                    }
                }
            }
        }
    }); 
    
    function detectIE() {
        var ua = window.navigator.userAgent;
    
        var msie = ua.indexOf('MSIE ');
        if (msie > 0) {
            // IE 10 or older => return version number
            return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);
        }
    
        var trident = ua.indexOf('Trident/');
        if (trident > 0) {
            // IE 11 => return version number
            var rv = ua.indexOf('rv:');
            return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);
        }
    
        var edge = ua.indexOf('Edge/');
        if (edge > 0) {
           // Edge (IE 12+) => return version number
           return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);
        }
    
        // other browser
        return false;
    }
</script>
<style>
    html, iframe, #IE_map{
        scroll-behavior: smooth;
        height: calc(100vh - 111px) !important;
        top: 111px !important;
    }
    #IE_map{
        margin:auto;
    }
    #iFrame1 .levels {
        top: unset;
    }
    @media (max-width: 768px) {
        html, iframe, #IE_map{
            height: calc(100vh - 100px) !important;
        }
        .home_hours_phone {
            display:none!important;
        }
    }
</style>